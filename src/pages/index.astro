---
import Hero from "@elements/Hero.astro";
import MainLayout from "@layouts/MainLayout.astro";
---

<MainLayout
	lang="en"
	title="Whirl | Home page"
>
	<Hero />
</MainLayout>

<script lang="js">
	var isOpen = false;
	var overlayElement = document.querySelector("[data-js-header-overlay]");
	var buttonElement = document.querySelector("[data-js-header-button]");
	var externalElements = [
		document.querySelector("[data-js-main]"),
		document.querySelector("[data-js-footer]"),
		document.querySelector("[data-js-header-home-button]"),
	];

	window.onload = function () {
		(function () {
			matchDevice();
			bindEvents();
		})();
	};

	function matchDevice() {
		if (window.matchMedia("(max-width: 767px)").matches) {
			document.documentElement.addEventListener("keydown", handleEsc);
			buttonElement.removeAttribute("hidden");
			overlayElement.setAttribute("tabindex", "-1");
			overlayElement.setAttribute("role", "dialog");
			overlayElement.setAttribute("aria-modal", "true");
			overlayElement.setAttribute("inert", "");
		} else {
			document.documentElement.removeEventListener("keydown", handleEsc);
			buttonElement.setAttribute("hidden", "");
			overlayElement.removeAttribute("tabindex");
			overlayElement.removeAttribute("role");
			overlayElement.removeAttribute("aria-modal");
			overlayElement.removeAttribute("inert");
		}
	}

	var handleEsc = (e) => {
		if (e.key === "Escape") {
			onButtonClick();
		}
	};

	var onButtonClick = () => {
		isOpen = !isOpen;
		document.documentElement.classList.toggle("is-lock");
		buttonElement.classList.toggle("is-active");
		overlayElement.classList.toggle("is-active");
		buttonElement.setAttribute("title", isOpen ? "Close menu" : "Open menu");
		buttonElement.setAttribute("aria-label", isOpen ? "Close menu" : "Open menu");
		buttonElement.toggleAttribute("aria-expanded", isOpen);
		overlayElement.toggleAttribute("inert");
		externalElements.forEach((element) => {
			element.toggleAttribute("inert");
		});
	};

	function bindEvents() {
		buttonElement.addEventListener("click", onButtonClick);

		let resizeTimer;
		window.addEventListener("resize", () => {
			matchDevice();
			overlayElement.classList.add("no-transition");
			clearTimeout(resizeTimer);
			resizeTimer = setTimeout(() => {
				overlayElement.classList.remove("no-transition");
			}, 300);
		});
	}
</script>
